# defcon-2025-domain-fronting
Defcon 2025 Malware Village Domain Fronting Talk

Building on the great work of karthika subramani

@misc{paper_link, title = {Discovering and Measuring CDNs Prone to Domain Fronting}, year = {2024}, howpublished = {\url{https://doi.org/10.1145/3589334.3645656}} }

https://github.com/karthikaS03/DomainFrontingDiscovery

## 1. CDN List (Manual Process)

To rank and test a collection of CDNs we need a list of CDNs! 

This was gathered through some Googling and manual research
and then [PeeringDB](https://www.peeringdb.com/net/906) and [HackerTarget](https://hackertarget.com/as-ip-lookup/) were used
to associate each CDN with their ASN number. 

We store this list in `cdn_asn.csv`

Data Collection Date: 2025-07-06

## 2. ASN to IP Map

We then use the `cdn-asn-ip-map` Go program to covert all the CDN ASN numbers to a collection of IP addresses
which we dump as JSON to be used in a lookup table. 
This uses the free https://iptoasn.com tab separated database to perform the lookup.

```shell
go run cmd/cdn-asn-ip-map/main.go
```

## 3. Prepare domain list

We now need to visit / scape a large number of sites to find which CDNs are used to host them. In order todo that we need a large list
of websites to visit.
- https://tranco-list.eu/ - For the top 1 million domains

## 4. Scrape domains and analyze CDN usage

The `scape` tool processes a list of domains, uses Common Crawl to fetch information about each domain's resources, and generates a JSON report with CDN information.

```shell
go run cmd/scape/main.go -input top-1m.csv -cdn-map cdn_asn_to_ip_map.json -output resources.json
```

### Command-line options:

- `-input`: Path to the input domain list file (default: "top-1m.csv")
- `-cdn-map`: Path to the CDN to IP mapping file (default: "cdn_asn_to_ip_map.json")
- `-output`: Path to the output JSON file (default: "resources.json")

### Output format:

The tool generates a JSON file containing an array of resource information objects:

```json
[
  {
    "cdn": "cloudfront",
    "original_domain": "example.com",
    "content_type": "text/javascript;charset=utf-8",
    "resource_url": "https://example.com/script.js",
    "server_ip": "192.0.2.1"
  },
  {
    "cdn": "akamai",
    "original_domain": "another-example.com",
    "content_type": "text/css",
    "resource_url": "https://another-example.com/styles.css",
    "server_ip": "192.0.2.2"
  }
]
```

### Notes

Most of the code in this repo was generated by Jetbrains Junie AI Agent, it should be taken with a pinch of salt.
